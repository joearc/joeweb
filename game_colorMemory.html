<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foreground Color Match - 前景色彩挑戰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

        :root {
            --bg:        #1a1612;
            --surface:   #231e19;
            --border:    #3a3028;
            --muted:     #6b5e4e;
            --label:     #9e8c78;
            --text:      #e8ddd0;
            --accent:    #c4a882;
            --accent-dk: #a0845e;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            overflow-x: hidden;
        }

        .global-nav {
            width: 100%;
            background-color: var(--surface);
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }
        .global-nav ul {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            list-style: none;
            flex-wrap: wrap;
        }
        .global-nav a {
            color: var(--label);
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 600;
            transition: color 0.2s;
        }
        .global-nav a:hover {
            color: var(--accent);
        }

        .slider-hue {
            background: linear-gradient(to right, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%);
        }
        input[type=range] {
            -webkit-appearance: none;
            background: var(--border);
            height: 8px;
            border-radius: 4px;
            flex-grow: 1;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.6);
        }
        .step-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background-color: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            transition: all 0.2s;
            user-select: none;
            cursor: pointer;
            color: var(--label);
        }
        .step-btn:hover {
            background-color: var(--border);
            color: var(--text);
        }
        .step-btn:active {
            transform: scale(0.9);
            background-color: var(--accent-dk);
            color: var(--bg);
        }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen">

    <div id="nav" class="w-full mb-12"></div>
    <script>
      fetch("./nav.html")
        .then(r => r.text())
        .then(html => document.getElementById("nav").innerHTML = html);
    </script>

    <div id="game-container" class="w-full max-w-2xl text-center px-4">
        <!-- 頂部資訊 -->
        <div class="flex justify-between items-center mb-6 px-4">
            <h1 class="text-2xl font-black tracking-tighter" style="color:var(--text)">
                COLOR <span style="color:var(--accent)">MATCH</span>
            </h1>
            <div id="progress-tag" class="hidden px-4 py-1 rounded-full text-xs font-mono border"
                 style="background:var(--surface); color:var(--accent); border-color:var(--border)">
                ROUND: <span id="current-round">1</span>/5
            </div>
        </div>

        <!-- 核心比對區域 -->
        <div id="play-area" class="hidden grid grid-cols-2 gap-4 mb-8">
            <div id="target-bg" class="aspect-[4/5] rounded-[2rem] flex items-center justify-center shadow-2xl relative transition-colors duration-700">
                <div id="target-fg" class="w-1/2 aspect-square rounded-2xl shadow-lg border border-white/10 transition-colors duration-700"></div>
                <div class="absolute bottom-4 text-[10px] font-bold uppercase tracking-widest" style="color:var(--label); opacity:0.7">目標 (Target)</div>
            </div>
            <div id="user-bg" class="aspect-[4/5] rounded-[2rem] flex items-center justify-center shadow-2xl relative transition-colors duration-700">
                <div id="user-fg" class="w-1/2 aspect-square rounded-2xl shadow-lg border border-white/10 transition-colors duration-300"></div>
                <div class="absolute bottom-4 text-[10px] font-bold uppercase tracking-widest" style="color:var(--label); opacity:0.7">你的調色 (You)</div>
            </div>
        </div>

        <!-- 調色控制項 -->
        <div id="controls" class="max-w-md mx-auto space-y-4 hidden">
            <div class="grid gap-4 p-6 rounded-3xl border"
                 style="background:rgba(35,30,25,0.65); border-color:var(--border)">
                <!-- 色相 Hue -->
                <div>
                    <div class="flex justify-between text-[10px] font-bold uppercase mb-2" style="color:var(--muted)">
                        <span>色相 Hue</span><span id="val-hue">0°</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button class="step-btn" onclick="adjustValue('hue', -1)">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </button>
                        <input type="range" id="hue" min="0" max="360" value="0" class="slider-hue appearance-none">
                        <button class="step-btn" onclick="adjustValue('hue', 1)">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                    </div>
                </div>
                <!-- 彩度 Saturation -->
                <div>
                    <div class="flex justify-between text-[10px] font-bold uppercase mb-2" style="color:var(--muted)">
                        <span>彩度 Saturation</span><span id="val-sat">40%</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button class="step-btn" onclick="adjustValue('sat', -1)">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </button>
                        <input type="range" id="sat" min="0" max="100" value="40" class="appearance-none">
                        <button class="step-btn" onclick="adjustValue('sat', 1)">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                    </div>
                </div>
                <!-- 明度 Lightness -->
                <div>
                    <div class="flex justify-between text-[10px] font-bold uppercase mb-2" style="color:var(--muted)">
                        <span>明度 Lightness</span><span id="val-light">60%</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button class="step-btn" onclick="adjustValue('light', -1)">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </button>
                        <input type="range" id="light" min="0" max="100" value="60" class="appearance-none">
                        <button class="step-btn" onclick="adjustValue('light', 1)">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                    </div>
                </div>
            </div>

            <button id="submit-btn" class="w-full py-4 font-bold rounded-2xl transition-all active:scale-95"
                    style="background:var(--accent-dk); color:var(--bg); box-shadow:0 8px 24px rgba(160,132,94,0.18)"
                    onmouseover="this.style.background='var(--accent)'"
                    onmouseout="this.style.background='var(--accent-dk)'">
                確認答案
            </button>
        </div>

        <!-- 每一題反饋 -->
        <div id="round-feedback" class="hidden space-y-4 max-w-md mx-auto">
            <div class="p-6 rounded-3xl border"
                 style="background:rgba(35,30,25,0.7); border-color:var(--border)">
                <p class="text-xs uppercase tracking-widest mb-1" style="color:var(--muted)">本題得分</p>
                <p id="round-score" class="text-5xl font-black" style="color:var(--text)">0</p>
            </div>
            <button id="next-btn" class="w-full py-4 font-bold rounded-2xl transition-all border"
                    style="background:var(--surface); color:var(--text); border-color:var(--border)"
                    onmouseover="this.style.background='var(--border)'"
                    onmouseout="this.style.background='var(--surface)'">
                下一題
            </button>
        </div>

        <!-- 結算畫面 -->
        <div id="final-screen" class="hidden space-y-6 max-w-md mx-auto">
            <div class="p-10 rounded-[3rem] shadow-2xl"
                 style="background: linear-gradient(135deg, #3d2e1e 0%, #2a1f12 100%); border: 1px solid var(--accent-dk)">
                <p class="text-sm font-semibold uppercase tracking-widest mb-2" style="color:var(--label)">挑戰結束</p>
                <h2 id="total-score" class="text-8xl font-black mb-2" style="color:var(--accent)">0</h2>
                <p id="average-text" class="text-sm" style="color:var(--muted)">平均得分 0</p>
            </div>
            <button onclick="initGame()" class="w-full py-4 font-bold rounded-2xl border transition-all"
                    style="background:var(--surface); color:var(--text); border-color:var(--border)"
                    onmouseover="this.style.background='var(--border)'"
                    onmouseout="this.style.background='var(--surface)'">
                再次挑戰
            </button>
        </div>

        <!-- 開始畫面 -->
        <div id="start-screen" class="max-w-md mx-auto">
            <div class="p-8 rounded-[2.5rem] mb-8 border"
                 style="background:rgba(35,30,25,0.5); border-color:var(--border)">
                <p class="leading-relaxed mb-4" style="color:var(--label)">
                    調整右側的<span style="color:var(--text); font-weight:700">前景方塊</span>，<br>
                    使其與左側的目標顏色一致。
                </p>
                <p class="text-xs uppercase tracking-tighter" style="color:var(--muted)">一共五題</p>
            </div>
            <button onclick="initGame()" class="px-12 py-4 font-bold rounded-2xl transition-all active:scale-95"
                    style="background:var(--accent-dk); color:var(--bg); box-shadow:0 8px 24px rgba(160,132,94,0.2)"
                    onmouseover="this.style.background='var(--accent)'"
                    onmouseout="this.style.background='var(--accent-dk)'">
                開始挑戰
            </button>
        </div>
    </div>

    <script>
        let currentRound = 0;
        let totalScore = 0;
        let targetForeground;
        let commonBackground;
        const TOTAL_ROUNDS = 5;

        const playArea = document.getElementById('play-area');
        const targetBg = document.getElementById('target-bg');
        const targetFg = document.getElementById('target-fg');
        const userBg = document.getElementById('user-bg');
        const userFg = document.getElementById('user-fg');
        const controls = document.getElementById('controls');
        const startScreen = document.getElementById('start-screen');
        const roundFeedback = document.getElementById('round-feedback');
        const finalScreen = document.getElementById('final-screen');
        const progressTag = document.getElementById('progress-tag');

        const hueIn = document.getElementById('hue');
        const satIn = document.getElementById('sat');
        const lightIn = document.getElementById('light');

        function getMutedColor() {
            const h = Math.random() * 360;
            const s = 0.3 + Math.random() * 0.4;
            const l = 0.4 + Math.random() * 0.3;
            return chroma.hsl(h, s, l);
        }

        function adjustValue(id, step) {
            const input = document.getElementById(id);
            const newValue = parseInt(input.value) + step;
            if (newValue >= input.min && newValue <= input.max) {
                input.value = newValue;
                updateUserColor();
            }
        }

        function initGame() {
            currentRound = 0;
            totalScore = 0;
            startScreen.classList.add('hidden');
            finalScreen.classList.add('hidden');
            playArea.classList.remove('hidden');
            progressTag.classList.remove('hidden');
            nextRound();
        }

        function nextRound() {
            currentRound++;
            if (currentRound > TOTAL_ROUNDS) {
                showSummary();
                return;
            }
            document.getElementById('current-round').innerText = currentRound;
            roundFeedback.classList.add('hidden');
            controls.classList.remove('hidden');

            commonBackground = getMutedColor().darken(2).desaturate(0.5);
            targetBg.style.backgroundColor = commonBackground.hex();
            userBg.style.backgroundColor = commonBackground.hex();

            targetForeground = getMutedColor();
            targetFg.style.backgroundColor = targetForeground.hex();

            hueIn.value = Math.floor(Math.random() * 360);
            satIn.value = 40;
            lightIn.value = 60;
            updateUserColor();
        }

        function updateUserColor() {
            const h = hueIn.value;
            const s = satIn.value / 100;
            const l = lightIn.value / 100;
            const userColor = chroma.hsl(h, s, l);
            userFg.style.backgroundColor = userColor.hex();
            document.getElementById('val-hue').innerText = h + "°";
            document.getElementById('val-sat').innerText = satIn.value + "%";
            document.getElementById('val-light').innerText = lightIn.value + "%";
        }

        [hueIn, satIn, lightIn].forEach(el => el.addEventListener('input', updateUserColor));

        document.getElementById('submit-btn').onclick = () => {
            const h = hueIn.value;
            const s = satIn.value / 100;
            const l = lightIn.value / 100;
            const userColor = chroma.hsl(h, s, l);
            const deltaE = chroma.deltaE(targetForeground, userColor);
            const score = Math.max(0, 100 - (deltaE * 2.8));
            totalScore += score;
            controls.classList.add('hidden');
            document.getElementById('round-score').innerText = score.toFixed(1);
            roundFeedback.classList.remove('hidden');
        };

        document.getElementById('next-btn').onclick = nextRound;

        function showSummary() {
            playArea.classList.add('hidden');
            progressTag.classList.add('hidden');
            roundFeedback.classList.add('hidden');
            finalScreen.classList.remove('hidden');
            document.getElementById('total-score').innerText = totalScore.toFixed(0);
            document.getElementById('average-text').innerText = `總平均得分 ${(totalScore / TOTAL_ROUNDS).toFixed(1)}`;
        }
    </script>
</body>
</html>